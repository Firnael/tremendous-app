<!-- Roster page -->
<!-- Sidebar -->
<trmds-side-bar page="roster"></trmds-side-bar>

<div class="rows-wrapper" ng-class="$root.open">

<div class="row title-bar">
  <div class="col-md-12">
    <h2>Roster <small class="fade" ng-show="vm.roster.length">
      Derniere MaJ: {{ vm.getRosterLastUpdate() }}
    </small></h2>
  </div>
</div>
<br/>

<!-- Update progress -->
<div class="row text-center" ng-show="vm.updating === true && vm.rosterSize > 0">
  <div class="col-md-offset-4 col-md-4 text-center">
    <h2>Updating roster</h2>
    <div class="progress">
      <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" ng-style="{ 'width': vm.getUpdateProgress() + '%' }">
      </div>
    </div>
    {{ vm.updateCount }} / {{ vm.rosterSize }}
  </div>
</div>

<!-- Roster -->
<div class="row fade" ng-show="vm.updating === false">
  <div class="col-md-9" style="border-right: 1px dashed #555;">
    <table class="table table-condensed table-hover roster-table">
    <thead>
      <tr>
        <th></th>
        <th></th>
        <th><trmds-slot-icons slot="head" size="24"></trmds-slot-icons></th>
        <th><trmds-slot-icons slot="neck" size="24"></trmds-slot-icons></th>
        <th><trmds-slot-icons slot="shoulder" size="24"></trmds-slot-icons></th>
        <th><trmds-slot-icons slot="back" size="24"></trmds-slot-icons></th>
        <th><trmds-slot-icons slot="chest" size="24"></trmds-slot-icons></th>
        <th><trmds-slot-icons slot="wrist" size="24"></trmds-slot-icons></th>
        <th><trmds-slot-icons slot="hands" size="24"></trmds-slot-icons></th>
        <th><trmds-slot-icons slot="waist" size="24"></trmds-slot-icons></th>
        <th><trmds-slot-icons slot="legs" size="24"></trmds-slot-icons></th>
        <th><trmds-slot-icons slot="feet" size="24"></trmds-slot-icons></th>
        <th><trmds-slot-icons slot="finger1" size="24"></trmds-slot-icons></th>
        <th><trmds-slot-icons slot="finger2" size="24"></trmds-slot-icons></th>
        <th><trmds-slot-icons slot="trinket1" size="24"></trmds-slot-icons></th>
        <th><trmds-slot-icons slot="trinket2" size="24"></trmds-slot-icons></th>
        <th><trmds-slot-icons slot="mainHand" size="24"></trmds-slot-icons></th>
        <th><trmds-slot-icons slot="offHand" size="24"></trmds-slot-icons></th>
        <th><img src="http://wow.zamimg.com/images/wow/icons/large/inv_jewelcrafting_70_saberseye.jpg" width="24" height="24" title="Enchants" class="img-rounded"/></th>
        <th><img src="http://wow.zamimg.com/images/wow/icons/large/inv_enchanting_70_chaosshard.jpg" width="24" height="24" title="Gemmes" class="img-rounded"/></th>
      </tr>
    </thead>
    <tbody>
      <tr ng-repeat="raider in vm.roster | orderBy:['+role', '+class', '-averageItemLevel']">
        <!-- Role -->
        <td style="text-align: left;">
          <trmds-role-icons role="{{ raider.role }}" size="24"></trmds-role-icons>
          <a ng-href="#/character/{{ raider.name }}" class="roster-item-name" ng-class="vm.getClassColor(raider.class)">
            {{ raider.name }}
          </a>
        </td>
        <!-- ilvl -->
        <td ng-class="vm.getIlvlColor(raider.averageItemLevel)">{{ raider.averageItemLevel }}</td>
        <!-- Slots -->
        <td ng-repeat="item in raider.items" class="roster-item-ilvl" ng-class="vm.getItemQualityColor(item.quality)">
          {{ item.ilvl ? item.ilvl : ''}}
        </td>
        <!-- Gems -->
        <td ng-class="raider.audit.equipedGems === raider.audit.gemSlots ? '' : 'roster-warning'">
          {{ raider.audit.equipedGems }}/{{ raider.audit.gemSlots }}
        </td>
        <!-- Enchants -->
        <td ng-class="raider.audit.missingEnchants > 0 ? 'roster-warning' : ''">
          {{ 4 - raider.audit.missingEnchants }}/4
        </td>
      </tr>
    </tbody>
  </table>
  </div>

  <!-- Roster info -->
  <div class="col-md-3 fade" ng-show="vm.rosterInfos">
    <div class="row">
      <div class="col-md-12">
        <h4>{{ vm.rosterInfos.size }} raiders</h4>
        <span class="roster-ilvl-lowest">{{ vm.rosterInfos.lowestItemLevel }}</span>
        <span class="roster-ilvl-average">{{ vm.rosterInfos.averageItemLevel }}</span>
        <span class="roster-ilvl-highest">{{ vm.rosterInfos.highestItemLevel }}</span>
      </div>
    </div>
    <br/>

    <!-- Armor types & Armor tokens -->
    <div class="row">
      <!-- Types -->
      <div class="col-md-6">
        <h4>Armor types</h4>
        <img src="http://wow.zamimg.com/images/wow/icons/large/inv_chest_plate04.jpg" width="24" height="24"/>
        {{ vm.rosterInfos.armorTypes.plate }}
        <br/>
        <img src="http://wow.zamimg.com/images/wow/icons/large/inv_chest_chain.jpg" width="24" height="24"/>
        {{ vm.rosterInfos.armorTypes.mail }}
        <br/>
        <img src="http://wow.zamimg.com/images/wow/icons/large/inv_chest_leather_10.jpg" width="24" height="24"/>
        {{ vm.rosterInfos.armorTypes.leather }}
        <br/>
        <img src="http://wow.zamimg.com/images/wow/icons/large/inv_chest_cloth_32.jpg" width="24" height="24"/>
        {{ vm.rosterInfos.armorTypes.cloth }}
        <br/>
      </div>
      <!-- Tokens -->
      <div class="col-md-6">
        <h4>Armor tokens</h4>
        <p>Vanquisher: {{ vm.rosterInfos.armorTokens.vanquisher }}</p>
        <p>Protector: {{ vm.rosterInfos.armorTokens.protector }}</p>
        <p>Conqueror: {{ vm.rosterInfos.armorTokens.conqueror }}</p>
      </div>
    </div>
    <br/>

    <!-- Class Distribution -->
    <div class="row">
      <h4 class="col-md-12">Class distribution</h4>
      <div class="col-md-6">
        <div ng-repeat="entry in vm.rosterInfos.classes" ng-if="entry.classId <= 6">
          <trmds-class-icons char-class="{{ entry.classId }}" size="24"></trmds-class-icons> {{ entry.count }}
        </div>
      </div>
      <div class="col-md-6">
        <div ng-repeat="entry in vm.rosterInfos.classes" ng-if="entry.classId > 6">
          <trmds-class-icons char-class="{{ entry.classId }}" size="24"></trmds-class-icons> {{ entry.count }}
        </div>
      </div>
    </div>

    <br/>
    <a class="btn btn-default" ng-click="vm.updateRoster()">Update</a>

  </div>

</div>
</div>
